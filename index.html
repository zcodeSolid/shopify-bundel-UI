{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign current_image = current_variant.featured_image | default: product.featured_image -%}

<!-- Get products from the same collection -->
{%- if collection and collection.all_products_count > 1 -%}
  {%- assign related_products = collection.products | where: "available", true | where: "id", "!=", product.id | limit: 5 -%}
{%- else -%}
  <!-- Fallback: Get products from all collections this product belongs to -->
  {%- assign related_products = product.collections.first.products | where: "available", true | where: "id", "!=", product.id | limit: 5 -%}
{%- endif -%}
  <div class="bundle-title-div">
  <p class="bundle-title">{{ 'categoryProductPageGlasses.bundle.title' | t }}</p>
  </div>
<div class="bundle-wrapper" id="bundle-{{ product.id }}">

  <div class="bundle-option" style="    overflow: hidden;">
    <input type="radio" name="bundle_option" value="single" id="single-{{ product.id }}" >
    <label for="single-{{ product.id }}" class="bundle-option-header">
      <div class="option-title">
        <span class="checkmark"></span>
        <div class="promo-header">
          <h4>{{ 'categoryProductPageGlasses.bundle.options.single.title' | t }}</h4>
          <p>{{ 'categoryProductPageGlasses.bundle.options.single.subtitle' | t }}</p>
        </div>
      </div>
      <div class="option-price">
        <span class="old-price">{{ current_variant.compare_at_price | default: current_variant.price | money }}</span>
        <span class="new-price">{{ current_variant.price | money }}</span>
      </div>
    </label>
    <div class="bundle-option-content" style="display: none !important;">
      <!-- <div class="product-preview">
        <img src="{{ current_image | img_url: '120x120', crop: 'center' }}" alt="{{ product.title }}" class="product-image">
        <div class="product-info">
          <h5>{{ product.title }}</h5>
          <p class="variant-title">{{ current_variant.title }}</p>
        </div>
      </div> -->
      <!-- <p class="subtitle">Standard price</p> -->
    </div>
  </div>

  <!-- OPTION 2: Buy 1 Get 1 -->
  <div class="bundle-option" style="margin-bottom: 0;">
    <input type="radio" name="bundle_option" value="bogo" id="bogo-{{ product.id }}" checked>
    <label for="bogo-{{ product.id }}" style="padding-top: 20px;" class="bundle-option-header">
      <div class="option-title">
        <span class="checkmark"></span>
        <div class="promo-header">
<h4>{{ 'categoryProductPageGlasses.bundle.options.bogo.title' | t }}</h4>
<p>{{ 'categoryProductPageGlasses.bundle.options.bogo.subtitle' | t }}</p>
        </div>
      </div>
<div class="offer-badge">{{ 'categoryProductPageGlasses.bundle.options.bogo.badge' | t }}</div>
      <div class="option-price" bis_skin_checked="1">
        <span class="old-price"><span class="bundle-old-price"></span></span>
        <span class="new-price"><span class="bundle-new-price"></span></span>
      </div>

    </label>
    <div class="bundle-option-content">

  <div class="promo-box">
    <div class="countdown">
      <div class="timebox">
        <div class="num" id="days">0</div>
        <div class="labelN">Days</div>
      </div>
      <div class="timebox">
        <div class="num" id="hours">0</div>
        <div class="labelN">Hours</div>
      </div>
      <div class="timebox">
        <div class="num" id="minutes">0</div>
        <div class="labelN">Min</div>
      </div>
      <div class="timebox">
        <div class="num" id="seconds">0</div>
        <div class="labelN">Sec</div>
      </div>
    </div>
  </div>


      <div class="bogo-selection">
        <div class="selected-product" style="">
          <div class="products-selected" style="position: relative;max-width: fit-content;">
          <div class="product-circle">
            <img src="{{ current_image | img_url: '120x120', crop: 'center' }}" alt="{{ product.title }}">
            
          </div>
          <span class="product-badge">1</span>
        </div>
          <!-- <p style="margin: 0 0 4px 0;
    font-size: 12px;
    line-height: 1.3;">{{ product.title }}</p> -->
        <div class="option-price">
        <!-- <span class="old-price">{{ current_variant.compare_at_price | default: current_variant.price | money }}</span>
        <span class="new-price">{{ current_variant.price | money }}</span> -->
      </div>
        </div>
        
        <div class="divider">
          <span>+</span>
        </div>
        
<div class="second-product">
  {% if collections['blauwlichtbrillen'].products.size > 0 %}
    <div class="products-carousel">
      {% for product in collections['blauwlichtbrillen'].products %}
        {% assign related_variant = product.selected_or_first_available_variant %}
        <label class="product-option">
          <input 
  type="radio" 
  name="second_product" 
  value="{{ related_variant.id }}" 
  data-price="{{ related_variant.price }}" 
  data-compare="{{ related_variant.compare_at_price | default: related_variant.price }}" 
  data-stock="{{ related_variant.inventory_quantity | default: 0 }}">

          <div class="product-circle">
            <img src="{{ product.featured_image | img_url: '120x120', crop: 'center' }}" alt="{{ product.title }}">
            
          </div>
          <span class="product-badge">2</span>
          <!-- <p>{{ product.title }}</p> -->
      <div class="option-price">
        <!-- <span class="old-price">{{ product.compare_at_price | default: product.price | money }}</span>
        <span class="new-price">{{ product.price | money }}</span> -->
      </div>
        </label>
      {% endfor %}
    </div>
  {% else %}
    <p>No related products found</p>
  {% endif %}
</div>
      </div>
    </div>
  </div>


</div>


<form id="custom-add-to-cart-form" >
  <input type="hidden" name="id" value="{{  product.id }}">

  <div class="custom-cart-wrapper" style="display:none !important;">
    <div class="custom-cart-button-wrapper" style="display:none !important;">
      <button type="submit" class="custom-add-to-cart" style="display:none !important;">
        <svg role="presentation" stroke-width="2" focusable="false" class="icon icon-cart" viewBox="0 0 22 22">
          <path d="M9.182 18.454a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.818 0Zm7.272 0a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.819 0Z" fill="currentColor"></path>
          <path d="M5.336 6.636H21l-3.636 8.182H6.909L4.636 3H1m8.182 15.454a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.818 0Zm7.272 0a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.819 0Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>{{ 'products.product.add_to_cart' | t }}</span>
      </button>
    </div>

    <div class="custom-qty-selector">
      <button type="button" onclick="updateQty(-1)">-</button>
      <input id="quantity" name="quantity" value="1" readonly>
      <button type="button" onclick="updateQty(1)">+</button>
    </div>
  </div>
</form>


<button id="bundle-add-{{ product.id }}" class="bundle-btn">
  <svg role="presentation" stroke-width="2" focusable="false" class="icon icon-cart" viewBox="0 0 22 22">
    <path d="M9.182 18.454a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.818 0Zm7.272 0a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.819 0Z" fill="currentColor"></path>
    <path d="M5.336 6.636H21l-3.636 8.182H6.909L4.636 3H1m8.182 15.454a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.818 0Zm7.272 0a.91.91 0 1 1-1.818 0 .91.91 0 0 1 1.819 0Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
  </svg>
  <span>{{ 'products.product.add_to_cart' | t }}</span>
  <span style="display:none;" class="bundle-total-price"></span>
  <span style="display:none;" class="bundle-stock"></span>
</button>



<style>

p.bundle-title {
    font-size: 18px;
    margin: 5px;
    font-weight: bold;
    margin-top: 10px;
}

  .promo-header p {
    font-size: 14px;
    margin: 0;
}
.promo-header h4 {
    line-height: normal;
    font-size: large;
}
.bundle-btn svg.icon.icon-cart {
    width: 24px;
    height: 24px;
    position: relative;
    left: -4px;
    flex-shrink: 0;
}

.bundle-wrapper {
  border: 1px solid #e5e5e5;
  border-radius: 16px;
      padding: 20px;
  margin: 0 0 20px 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #fff;
}

.bundle-option {
  margin-bottom: 16px;
  border: 1px solid #e5e5e5;
  border-radius: 12px;
      background: #fffbfa;
}

.bundle-option > input {
  display: none;
}

.bundle-option-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background: #fffbfa;
  cursor: pointer;
  transition: background-color 0.2s ease;
  position: relative;
}

.bundle-option > input:checked + .bundle-option-header {
  /* background: #f0f9ff; */
  /* border-bottom: 1px solid #e5e5e5; */
}

.option-title {
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
}

.checkmark {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid #ccc;
  border-radius: 50%;
  position: relative;
}

.bundle-option > input:checked + .bundle-option-header .checkmark {
  border-color: #252525;
  background: #252525;
}

.bundle-option > input:checked + .bundle-option-header .checkmark:after {
  content: "";
  position: absolute;
  top: 4px;
  left: 4px;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
}

.option-title h4 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}

.offer-badge {
    background: #FBDFD8;
    color: #F4795B;
    padding: 5px 15px;
    font-size: 15px;
    border-radius: 10px;
    font-weight: 600;
    position: absolute;
    top: -10px;
    left: 45%;
    font-weight: 500;
}

/* .option-price {
  text-align: right;
} */

.old-price {
  display: block;
  text-decoration: line-through;
  color: #999;
  font-size: 14px;
}

.new-price {
  display: block;
  font-weight: 500;
  font-size: 18px;
}

.bundle-option-content {
  display: none;
padding: 5px 16px 0 20px;
}

.bundle-option > input:checked ~ .bundle-option-content {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.product-preview {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.product-image {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  object-fit: cover;
}

.product-info h5 {
  margin: 0 0 4px 0;
  font-size: 16px;
}

.variant-title {
  margin: 0;
  color: #666;
  font-size: 14px;
}

.subtitle {
  margin: 0;
  color: #666;
  font-size: 14px;
}

.bogo-selection {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
}

/* .selected-product, .second-product {
  flex: 1;
  text-align: center;
  position: relative;
} */

.selected-product h5, .second-product h5 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #333;
}

.divider {
  font-size: 24px;
  font-weight: bold;
  color: #666;
}

.products-carousel {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 8px 2px;
  width: 100%;
}
.second-product {
    overflow-x: hidden;
}
.selected-product {
    padding-right: 5px;
}
.products-carousel::-webkit-scrollbar {
  height: 4px;
}

.products-carousel::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 4px;
}

.product-option {
  position: relative;
  cursor: pointer;
  text-align: center;
}

.product-option > input {
  display: none;
}

.product-option > input:checked + .product-circle {
  border-color: #171717;
  box-shadow: 0 0 0 2px #ffffff;
}

.product-circle {
    width: 70px;
    height: 70px;
    border-radius: 20%;
    border: 2px solid #e5e5e5;
    overflow: hidden;
    position: relative;
    margin: 0 auto 8px;
    transition: all 0.2s ease;
}

.product-circle img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-badge {
    position: absolute;
    top: -8px;
    right: -10px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    border: 1px solid #f000;
}

.product-option p {
  margin: 0 0 4px 0;
  font-size: 12px;
  line-height: 1.3;
}

.discount-price {
  font-size: 14px;
  font-weight: 600;
  color: #e0002a;
}

.bundle-btn {
    width: 100%;
    margin-top: 16px;
    background: #1d1d1d;
    color: #fff;
    border: none;
    border-radius: 30px;
    padding: 15px;
    font-weight: 900;
    font-size: 17px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 7px;
}

.bundle-btn:hover {
  background: #000000;
  transform: translateY(-2px);
}

.bundle-btn:active {
  transform: translateY(0);
}

@media (max-width: 768px) {
  .bogo-selection {
    gap: 8px;
    padding: 0 7px
  }
  .bundle-option-content {
    padding: 0;
}
.bundle-wrapper {
    padding: 12px;
  }
  .option-title h4 {
    font-size: 14px;
}
.promo-header p {
    font-size: 12px;
    margin: 0;
}
.offer-badge {
    font-size: 10px;
    left: 35%;
}
  .divider {
    transform: rotate(90deg);
  }

  .urgent {
    font-size: 10px !important;
    padding: 4px 8px !important;

}
.num {
    font-size: 13px !important;
}
.timebox {
        border-radius: 6px !important;
        min-width: 60px !important;
}
h3.bundle-title {
    top: -35px;
    padding: 0;
    font-size: 18px;
 
}
}

.products-carousel {
  user-select: none; 
  -webkit-user-drag: none; 
  cursor: grab; 
}

.products-carousel:active {
  cursor: grabbing;
}








 .promo-box {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 18px;
      background: #fffbfa;
      border-radius: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .urgent {
      background: #F37021;
      color: #FFFFFF;
      font-weight: 700;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      white-space: nowrap;
    }
    .countdown {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .timebox {
      background: #FFFFFF;
      padding: 6px 8px;
      border-radius: 6px;
      min-width: 48px;
      text-align: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .num {
    font-size: 15px;
    font-weight: bold;
    color: #000000;
    }
    .labelN {
      font-size: 9px;
      color: #555555;
      margin-top: 0px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
</style>

<script>

let globalData = {
  previousUrl: '',
  productId: {{ current_variant.id }},  
  variantId: {{ current_variant.id }}
};

  (function () {
    const onUrlChange = (newUrl) => {
      const normalizedUrl = new URL(newUrl, window.location.origin).toString();

      if (normalizedUrl === previousUrl) return;
      const urlParams = new URL(newUrl, window.location.origin).searchParams;
      const variantId = urlParams.get('variant');
      console.log("Variant ID:", variantId);
      globalData.variantId = variantId ? variantId : globalData.productId;
      previousUrl = normalizedUrl;
    };

    const getCurrentUrl = () => window.location.href;
    let previousUrl = getCurrentUrl();

    const observer = new MutationObserver(() => {
      const currentUrl = getCurrentUrl();
      if (currentUrl !== previousUrl) {
        previousUrl = currentUrl;
        onUrlChange(currentUrl);
      }
    });
    observer.observe(document.body, { childList: true, subtree: true });

    window.addEventListener('popstate', () => {
      const currentUrl = getCurrentUrl();
      if (currentUrl !== previousUrl) {
        previousUrl = currentUrl;
        onUrlChange(currentUrl);
      }
    });
    const originalPushState = history.pushState;
    const originalReplaceState = history.replaceState;

    history.pushState = function(state, title, url) {
      originalPushState.apply(this, arguments);
      onUrlChange(url);
    };

    history.replaceState = function(state, title, url) {
      originalReplaceState.apply(this, arguments);
      onUrlChange(url);
    };
  })();

			const bundleAddBtn = document.getElementById('bundle-add-{{ product.id }}');
        const errorSpan = document.createElement('span');
  errorSpan.style.color = 'red';
  errorSpan.style.display = 'block';
  errorSpan.style.marginTop = '8px';
  errorSpan.style.fontWeight = '500';
  errorSpan.style.fontSize = '14px';
  errorSpan.innerHTML = '⚠ Please select the second glasses option.';

  bundleAddBtn.parentNode.insertBefore(errorSpan, bundleAddBtn.nextSibling);
  errorSpan.style.display = 'none';

document.querySelectorAll('input[name="second_product"]').forEach((input) => {
  input.addEventListener('click', function() {
    errorSpan.style.display = 'none';
  });
});

document.querySelector('.bundle-option').addEventListener('click', function() {
    errorSpan.style.display = 'none';
  });



// Button click event listener for adding to the cart
bundleAddBtn.addEventListener('click', function() {
  const selectedOption = document.querySelector('input[name="bundle_option"]:checked').value;
  let itemsToAdd = [];  

  console.log('Selected option:', globalData.variantId);
  if (selectedOption === 'single') {
    const currentVariantId = globalData.variantId;  // Get the variant from global data
    itemsToAdd.push({ id: currentVariantId, quantity: 1 });
  } 
  // Add logic for bundle options
  else {
    const secondProductChecked = document.querySelector('input[name="second_product"]:checked');
    if (!secondProductChecked) {
      errorSpan.style.display = 'block';  // Show error message
      return;  // Exit the function if no second product is selected
    } else {
      errorSpan.style.display = 'none';  // Hide error message if second product is selected
    }

    const firstProductId = {{ current_variant.id }};  // Assuming this variable comes from templating
    const secondProductId = document.querySelector('input[name="second_product"]:checked').value;

    // Add both products to the cart
    itemsToAdd.push({ id: firstProductId, quantity: 1 }, { id: secondProductId, quantity: 1 });
  }

  // Send the request to add items to the cart
  fetch('/cart/add.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ items: itemsToAdd })
  })
  .then(response => response.json())
  .then(data => {
    const cartDrawer = document.querySelector('cart-drawer');
    if (cartDrawer && typeof cartDrawer.open === 'function') {
      cartDrawer.open();  // Open the cart drawer
    }

    // Refresh the cart UI with the new data
    document.dispatchEvent(new CustomEvent('cart:refresh', { detail: { cart: data } }));

    return data;  // Optionally, you can log or use the cart data here
  })
  .catch(error => {
    console.error('Add to cart failed', error);
  });
});

// });


 const form = document.getElementById('custom-add-to-cart-form');
  const freebieVariantId = '51404791021907';

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const quantityInput = document.getElementById('quantity');
    const quantity = quantityInput ? parseInt(quantityInput.value) : 1;

    const selectedVariantInput = document.querySelector('input[name="id"]:checked')
                              || document.querySelector('select[name="id"]')
                              || document.querySelector('input[name="id"]');
    const variantId = selectedVariantInput?.value;

    fetch('/cart.js')
      .then(res => res.json())
      .then(cart => {
        const hasFreebie = cart.items.some(item => String(item.id) === String(freebieVariantId));

        if (hasFreebie) {
          console.log('Freebie already in cart, adding paid product only.');
          return addToCart(variantId, quantity);
        } else {
          console.log('Freebie not in cart, adding both paid product and freebie.');
                    return addToCart(variantId, quantity);
        }
      })
      .catch(err => console.error('Cart check failed:', err));
  });

  function addToCart(variantId, quantity = 1) {
    return fetch('/cart/add.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: variantId, quantity })
    })
    .then(response => response.json())
    .then(data => {
      const cartDrawer = document.querySelector('cart-drawer');
      if (cartDrawer && typeof cartDrawer.open === 'function') {
        cartDrawer.open();
      }
      document.dispatchEvent(new CustomEvent('cart:refresh', {
        detail: { cart: data }
      }));
      return data;
    })
    .catch(error => {
      console.error('Add to cart failed', error);
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    const button = document.querySelector('#AddToCartSticky');
    if (button) {
      button.addEventListener('click', function (e) {
        e.preventDefault();
        form.requestSubmit();
      });
    }
  });

</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  function formatMoney(cents) {
    if (typeof Shopify !== "undefined" && Shopify.formatMoney) {
      
      return Shopify.formatMoney(cents, "{{ shop.money_format }}");
    }
    console.log("shopify dosent there");
  return new Intl.NumberFormat("{{ shop.locale }}", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(cents / 100);
  }

  function updateBundlePrice() {
  // Base product
  var basePrice = {{ current_variant.price }};
  var baseCompare = {{ current_variant.compare_at_price | default: current_variant.price }};

  // Second product
  var secondProduct = document.querySelector('input[name="second_product"]:checked');
  if (!secondProduct) return;

  var secondPrice = parseInt(secondProduct.dataset.price);
  var secondCompare = parseInt(secondProduct.dataset.compare) || secondPrice;

  var cheaper = Math.min(basePrice, secondPrice);
  var expensive = Math.max(basePrice, secondPrice);

  var totalCompare = baseCompare + secondCompare; 
  var totalNew = expensive ; 

  var oldPriceEl = document.querySelector(".bundle-old-price");
  var newPriceEl = document.querySelector(".bundle-new-price");

  if (totalCompare > totalNew) {
    oldPriceEl.style.display = "inline";
    oldPriceEl.textContent = formatMoney(totalCompare);
  } else {
    oldPriceEl.style.display = "none";
  }
  newPriceEl.textContent = formatMoney(totalNew);
}

  updateBundlePrice();

  document.querySelectorAll('input[name="second_product"]').forEach(function(input) {
    input.addEventListener("change", updateBundlePrice);
  });
});


const scrollContainer = document.querySelector(".products-carousel");

let isDown = false;
let startX;
let scrollLeft;

scrollContainer.addEventListener("mousedown", (e) => {
  isDown = true;
  scrollContainer.classList.add("active");
  startX = e.pageX - scrollContainer.offsetLeft;
  scrollLeft = scrollContainer.scrollLeft;
});

scrollContainer.addEventListener("mouseleave", () => {
  isDown = false;
});

scrollContainer.addEventListener("mouseup", () => {
  isDown = false;
});

scrollContainer.addEventListener("mousemove", (e) => {
  if (!isDown) return;
  e.preventDefault();
  const x = e.pageX - scrollContainer.offsetLeft;
  const walk = (x - startX) * 2;
  scrollContainer.scrollLeft = scrollLeft - walk;
});

scrollContainer.querySelectorAll("img").forEach(img => {
  img.addEventListener("dragstart", (e) => e.preventDefault());
});


document.addEventListener("DOMContentLoaded", function() {
  function formatMoney(cents) {
    if (typeof Shopify !== "undefined" && Shopify.formatMoney) {
      return Shopify.formatMoney(cents, "{{ shop.money_format }}");
    }
    return new Intl.NumberFormat("{{ shop.locale }}", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(cents / 100);
  }

  function updateBundlePrice() {
    const selectedOption = document.querySelector('input[name="bundle_option"]:checked').value;

    let totalNew = 0;
    let totalCompare = 0;
    let totalStock = 0;

    if (selectedOption === "single") {
      const basePrice = {{ current_variant.price }};
      const baseCompare = {{ current_variant.compare_at_price | default: current_variant.price }};
      const baseStock = {{ current_variant.inventory_quantity | default: 0 }};

      totalNew = basePrice;
      totalCompare = baseCompare;
      totalStock = baseStock;

    } else {
      const basePrice = {{ current_variant.price }};
      const baseCompare = {{ current_variant.compare_at_price | default: current_variant.price }};
      const baseStock = {{ current_variant.inventory_quantity | default: 0 }};

      const secondProduct = document.querySelector('input[name="second_product"]:checked');
      if (!secondProduct) return;

      const secondPrice = parseInt(secondProduct.dataset.price);
      const secondCompare = parseInt(secondProduct.dataset.compare) || secondPrice;
      const secondStock = parseInt(secondProduct.dataset.stock || 0);

      const cheaper = Math.min(basePrice, secondPrice);
      const expensive = Math.max(basePrice, secondPrice);

      totalCompare = baseCompare + secondCompare;
      totalNew = expensive;

      totalStock = Math.min(baseStock, secondStock);
    }

    const oldPriceEl = document.querySelector(".bundle-old-price");
    const newPriceEl = document.querySelector(".bundle-new-price");

    if (totalCompare > totalNew) {
      oldPriceEl.style.display = "inline";
      oldPriceEl.textContent = formatMoney(totalCompare);
    } else {
      oldPriceEl.style.display = "none";
    }
    newPriceEl.textContent = formatMoney(totalNew);
    document.querySelector(".bundle-total-price").textContent = " – " + formatMoney(totalNew);
    document.querySelector(".bundle-stock").textContent = totalStock > 0 
      ? ` | In Stock: ${totalStock}` 
      : " | Out of Stock";
  }

  updateBundlePrice();

  document.querySelectorAll('input[name="bundle_option"]').forEach(function(input) {
    input.addEventListener("change", updateBundlePrice);
  });

  document.querySelectorAll('input[name="second_product"]').forEach(function(input) {
    input.addEventListener("change", updateBundlePrice);
  });
});
</script>




  <script>
    (function(){
      const endDate = new Date('2025-10-11T23:59:59').getTime();

      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');

      function tick() {
        const diff = endDate - Date.now();
        if(diff <= 0){
          daysEl.textContent = hoursEl.textContent = minutesEl.textContent = secondsEl.textContent = '0';
          return;
        }
        const s = Math.floor((diff/1000)%60);
        const m = Math.floor((diff/1000/60)%60);
        const h = Math.floor((diff/1000/60/60)%24);
        const d = Math.floor(diff/1000/60/60/24);
        daysEl.textContent = d;
        hoursEl.textContent = String(h).padStart(2,'0');
        minutesEl.textContent = String(m).padStart(2,'0');
        secondsEl.textContent = String(s).padStart(2,'0');
        requestAnimationFrame(tick);
      }
      tick();
    })();
  </script>